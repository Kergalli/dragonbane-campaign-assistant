<div class="session-advancement-content">
  {{!-- Actor Name Header with Token --}}
  <div class="actor-header">
    <img src="{{actor.prototypeToken.texture.src}}" alt="{{actor.name}}" class="actor-token" />
    <h2>{{actor.name}}</h2>
  </div>

  {{!-- Step Indicator --}}
  <div class="step-indicator">
    <div class="step {{#if isStep1}}active{{/if}}">
      <span class="step-number">1</span>
      <span class="step-label">{{localize "CAMPAIGN_ASSISTANT.steps.questions"}}</span>
    </div>
    <div class="step {{#if isStep2}}active{{/if}}">
      <span class="step-number">2</span>
      <span class="step-label">{{localize "CAMPAIGN_ASSISTANT.steps.select"}}</span>
    </div>
    <div class="step {{#if isStep3}}active{{/if}}">
      <span class="step-number">3</span>
      <span class="step-label">{{localize "CAMPAIGN_ASSISTANT.steps.roll"}}</span>
    </div>
  </div>

  {{!-- Step Instructions - centered below step indicator --}}
  <div class="step-hint">
    {{#if isStep1}}
    <em>{{localize "CAMPAIGN_ASSISTANT.instructions.questions"}}</em>
    {{/if}}
    {{#if isStep2}}
      {{#if hasSelectedSkills}}
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.readyToMark"}}</em>
      {{else if canAddMore}}
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.selectMore"}}</em>
      {{else}}
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.noMarksToUse"}}</em>
      {{/if}}
    {{/if}}
    {{#if isStep3}}
      {{#if hasMarkedSkills}}
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.readyToRoll"}}</em>
      {{else}}
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.noMarkedSkills"}}</em>
      {{/if}}
    {{/if}}
  </div>

  {{!-- Marks Available Counter - only on steps 1 & 2 --}}
  {{#unless isStep3}}
  {{#if isStep2}}
  {{#if (gte marksRemaining 0)}}
  <div class="marks-available">
    <strong>{{localize "CAMPAIGN_ASSISTANT.labels.marksAvailable"}}: {{marksRemaining}}</strong>
  </div>
  {{/if}}
  {{else}}
  <div class="marks-available">
    <strong>{{localize "CAMPAIGN_ASSISTANT.labels.marksEarned"}}: {{additionalMarks}}</strong>
  </div>
  {{/if}}
  {{/unless}}

  {{!-- STEP 1: Questions --}}
  {{#if isStep1}}
  <div class="step-content">
    <div class="questions-section">
      <h3 class="section-heading">{{localize "CAMPAIGN_ASSISTANT.sections.questions"}}</h3>
      
      <div class="questions">
        {{#each questions}}
        <label class="question">
          <input 
            type="checkbox" 
            name="question_{{id}}" 
            {{checked checked}}
            onchange="this.form.requestSubmit()"
          />
          <span>{{label}}</span>
        </label>
        {{/each}}
        
        {{!-- Weakness Question with Radio Buttons (Optional Rule) --}}
        {{#if useWeaknessRule}}
        {{#if hasWeakness}}
        <div class="weakness-question">
          <label class="section-heading"><strong>{{localize "CAMPAIGN_ASSISTANT.questions.weaknessLabel"}}</strong></label>
          <div class="weakness-options">
            <label class="weakness-option">
              <input 
                type="radio" 
                name="question_weakness" 
                value="none"
                {{#if weaknessNoneChecked}}checked{{/if}}
                onchange="this.form.requestSubmit()"
              />
              <span>{{localize "CAMPAIGN_ASSISTANT.questions.weaknessNone"}}</span>
            </label>
            <label class="weakness-option">
              <input 
                type="radio" 
                name="question_weakness" 
                value="gavein"
                {{#if weaknessGaveInChecked}}checked{{/if}}
                onchange="this.form.requestSubmit()"
              />
              <span>{{localize "CAMPAIGN_ASSISTANT.questions.weaknessGaveIn"}} <em>(+1 mark)</em></span>
            </label>
            <label class="weakness-option">
              <input 
                type="radio" 
                name="question_weakness" 
                value="overcame"
                {{#if weaknessOvercameChecked}}checked{{/if}}
                onchange="this.form.requestSubmit()"
              />
              <span>{{localize "CAMPAIGN_ASSISTANT.questions.weaknessOvercame"}} <em>(+2 marks, removes weakness)</em></span>
            </label>
          </div>
          
          <div class="weakness-display">
            <strong class="section-heading">{{localize "CAMPAIGN_ASSISTANT.labels.yourWeakness"}}:</strong> <span class="weakness-text">{{{currentWeakness}}}</span>
          </div>
        </div>
        {{/if}}
        {{/if}}
      </div>
    </div>
  </div>
  {{/if}}

  {{!-- STEP 2: Select Skills --}}
  {{#if isStep2}}
  <div class="step-content">
    {{#if unmarkedSkills}}
    <div class="unmarked-skills-section">
      <h3 class="section-heading">{{localize "CAMPAIGN_ASSISTANT.sections.selectSkills"}}</h3>
      <div class="skill-list">
        {{#each unmarkedSkills}}
        <div class="skill-item {{#if selected}}selected{{/if}}" 
             data-action="markSkill" 
             data-skill-id="{{id}}">
          <span class="skill-name">
            {{name}}
            {{#if taught}}<i class="fas fa-graduation-cap" title="Trained with teacher"></i>{{/if}}
          </span>
          <span class="skill-level">{{localize "CAMPAIGN_ASSISTANT.labels.level"}}: {{level}}</span>
          {{#if selected}}
          <i class="fas fa-check-circle"></i>
          {{/if}}
        </div>
        {{/each}}
      </div>
    </div>
    {{else}}
    <div class="empty-state">
      <p><em>{{localize "CAMPAIGN_ASSISTANT.instructions.noSkills"}}</em></p>
    </div>
    {{/if}}
  </div>
  {{/if}}

  {{!-- STEP 3: Ready to Roll --}}
  {{#if isStep3}}
  <div class="step-content">
    {{#if hasMarkedSkills}}
    <div class="marked-skills-section">
      <h3 class="section-heading">{{localize "CAMPAIGN_ASSISTANT.sections.markedSkills"}}</h3>
      <div class="skill-list marked">
        {{#each markedSkills}}
        <div class="skill-item {{#if newlyMarked}}newly-marked{{else}}marked{{/if}}">
          <span class="skill-name">
            {{name}}
            {{#if taught}}<i class="fas fa-graduation-cap" title="Trained with teacher"></i>{{/if}}
          </span>
          <span class="skill-level">{{localize "CAMPAIGN_ASSISTANT.labels.level"}}: {{level}}</span>
          <i class="fas fa-check"></i>
        </div>
        {{/each}}
      </div>
    </div>
    
    <div class="rules-reminder">
      <em>{{localize "CAMPAIGN_ASSISTANT.instructions.advancementRule"}}</em>
    </div>
    {{else}}
    <div class="empty-state">
      <p><em>{{localize "CAMPAIGN_ASSISTANT.instructions.noMarkedSkills"}}</em></p>
    </div>
    {{/if}}
  </div>
  {{/if}}

  {{!-- Navigation Buttons --}}
  <footer class="form-footer">
    {{#if isStep1}}
    <button type="submit" data-action="nextStep">
      <i class="fas fa-arrow-right"></i>
      <span>{{localize "CAMPAIGN_ASSISTANT.buttons.next"}}</span>
    </button>
    {{/if}}

    {{#if isStep2}}
    {{#if hasSelectedSkills}}
    <button type="submit" data-action="complete">
      <i class="fas fa-check"></i>
      <span>{{localize "CAMPAIGN_ASSISTANT.buttons.markSelected"}}</span>
    </button>
    {{else}}
    <button type="submit" data-action="nextStep">
      <i class="fas fa-arrow-right"></i>
      <span>{{localize "CAMPAIGN_ASSISTANT.buttons.next"}}</span>
    </button>
    {{/if}}
    {{/if}}

    {{#if isStep3}}
    {{#if hasMarkedSkills}}
    <button type="submit" data-action="rollAdvancement">
      <i class="fas fa-dice-d20"></i>
      <span>{{localize "CAMPAIGN_ASSISTANT.buttons.rollAdvancement"}}</span>
    </button>
    {{/if}}
    {{/if}}
  </footer>
</div>
